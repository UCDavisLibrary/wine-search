
<dom-module id="wine-bbox-preview">
  <template>
    <style>
      :host {
        display: none;
        position: absolute;
        left: 0;
        right: 0;
        z-index: 10000;
        height: 100vh;
    width: 100vw;
      }

      .background {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        z-index: 10001;
        background-color: rgba(0,0,0,.8);
      }

      img {
        max-width: 80vw;
        max-height: 80vh;
        z-index: 10002;
      }

      .bbox {
        border: 1px solid red;
        position: absolute;
        z-index: 10003;
      }

      a {
        cursor: pointer;
        color: white;
        padding: 8px;
        font-weight: bold;
        font-size: 16px;
      }
    </style>

    <div style="position:relative; height: 100vh; width: 100vw;">
      <div class="bbox"></div>

      <div class="background">
        <div style="position: relative;">
          <img id="image"/>
          <div id="bbox" class="bbox"></div>
        </div>
        
        <div><a on-click="hide">Close</a></div>
      </div>
    </div>

  </template>

  <script>
    class WineBboxPreview extends Polymer.Element {

      static get is() { return 'wine-bbox-preview'; }

      show(result) {
        this.result = result;
        this.$.bbox.style.display = 'none';

        let image = new Image();
        image.src = `https://digital.ucdavis.edu/ark:/87287/${result.ark}/media/images/${result.page_ark}.jpg/svc:iiif/full/full/0/default.jpg`;
        image.onload = () => {
          let h = image.height;
          let w = image.width;
          let bbox = JSON.parse(this.result.bbox);
          let coord = bbox.coordinates[0];

          let t = (coord[0][1]*-1)-75;
          let b = (coord[1][1]*-1)-75;
          let l = coord[0][0];
          let r = coord[2][0];

          t = (t/h)*100;
          b = 100-((b/h)*100);

          l = (l/w)*100;
          r = 100-((r/w)*100);

          this.$.bbox.style.top = t+'%';
          this.$.bbox.style.bottom = b+'%';
          this.$.bbox.style.left = l+'%';
          this.$.bbox.style.right = r+'%';
          this.$.bbox.style.display = 'block';
        }

        this.$.image.src = `https://digital.ucdavis.edu/ark:/87287/${result.ark}/media/images/${result.page_ark}.jpg/svc:iiif/full/full/0/default.jpg`;
        
        this.style.top = window.scrollY+'px';
        this.style.display = 'block';
        document.body.style.overflow = 'hidden';
      }

      hide() {
        this.style.display = 'none';
        document.body.style.overflow = 'auto';
      }

    }
    window.customElements.define(WineBboxPreview.is, WineBboxPreview);
  </script>
</dom-module>